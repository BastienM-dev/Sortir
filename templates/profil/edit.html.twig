{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/edit.css') }}">
{% endblock %}

{% block body %}
    <div class="container profile-page mt-5">

        <h1 class="text-center profile-title">Mon profil</h1>

        {# Flash messages centrés #}
        {% for message in app.flashes('success') %}
            <div class="alert alert-success alert-sortir text-center">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div class="alert alert-danger alert-sortir text-center">{{ message }}</div>
        {% endfor %}

        <div class="row justify-content-center profile-wrapper">

            {# Colonne Photo #}
            <div class="col-md-4 text-center mb-4">
                {% set currentUser = user ?? app.user %}
                {% set photoName = currentUser.photoFilename ?? null %}

                {% if photoName %}
                    <img
                            src="{{ asset('uploads/photos/' ~ photoName) }}?v={{ photoName }}"
                            class="avatar-round"
                            width="180"
                            height="180"
                            alt="Photo de profil"
                    >
                {% else %}
                    <div class="avatar-placeholder">Photo</div>
                {% endif %}
            </div>

            {# Colonne Formulaire #}
            <div class="col-md-6">
                {{ form_start(profileForm) }}

                {# erreurs globales (unicité pseudo/email, etc.) #}
                {{ form_errors(profileForm) }}

                {# Campus (non modifiable) #}
                <div class="form-row">
                    <div class="form-label-col">
                        <label>Campus</label>
                    </div>
                    <div class="form-input-col">
                        <input
                                type="text"
                                class="form-control sortir-input"
                                value="{{ currentUser.site.nom ?? '' }}"
                                disabled
                        >
                    </div>
                </div>

                {# Pseudo #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.pseudo) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.pseudo, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.pseudo) }}
                    </div>
                </div>

                {# Prénom #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.prenom) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.prenom, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.prenom) }}
                    </div>
                </div>

                {# Nom #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.nom) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.nom, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.nom) }}
                    </div>
                </div>

                {# Téléphone #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.telephone) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.telephone, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.telephone) }}
                    </div>
                </div>

                {# Email #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.mail) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.mail, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.mail) }}
                    </div>
                </div>

                {# Mot de passe #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.plainPassword.first) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.plainPassword.first, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.plainPassword.first) }}
                    </div>
                </div>

                {# Confirmation #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.plainPassword.second) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.plainPassword.second, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.plainPassword.second) }}
                    </div>
                </div>

                {# Upload photo : champ natif "Parcourir..." #}
                <div class="form-row">
                    <div class="form-label-col">
                        {{ form_label(profileForm.photo) }}
                    </div>
                    <div class="form-input-col">
                        {{ form_widget(profileForm.photo, {'attr': {'class': 'form-control sortir-input'}}) }}
                        {{ form_errors(profileForm.photo) }}
                    </div>
                </div>

                {# Bouton Enregistrer #}
                <div class="text-center mt-4">
                    <button class="btn-sortir btn-sortir--primary" type="submit">
                        Enregistrer
                    </button>
                </div>

                {{ form_end(profileForm) }}
            </div>
        </div>
    </div>
{% endblock %}
