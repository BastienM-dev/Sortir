{% extends 'base.html.twig' %}
{% block title %}Utilisateurs{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/admin.css') }}">
{% endblock %}

{% block body %}
    <main class="admin-page">

        <h1 class="admin-title">Liste des utilisateurs</h1>

        {# Affichage des messages flash (succ√®s / warning / erreur) #}
        {% for message in app.flashes('success') %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('warning') %}
            <div class="alert alert-warning">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div class="alert alert-danger">{{ message }}</div>
        {% endfor %}

        {# Formulaire de suppression multiple (bulk delete) #}
        <form method="post" action="{{ path('admin_users_delete') }}">
            {# üîí Token CSRF associ√© √† l'action "bulk_delete_users" #}
            <input type="hidden" name="_token" value="{{ csrf_token('bulk_delete_users') }}">

            <div class="admin-table-wrap">

                {# header fixe #}
                <table class="admin-table">
                    <thead>
                    <tr>
                        {# Checkbox ‚Äútout s√©lectionner‚Äù (optionnel) #}
                        <th class="admin-check-col">
                            <input
                                    type="checkbox"
                                    id="check_all"
                                    aria-label="Tout s√©lectionner"
                                    onclick="
                                const checks = document.querySelectorAll('input[name=&quot;user_ids[]&quot;]');
                                checks.forEach(c => c.checked = this.checked);
                                document.getElementById('btn_delete').disabled = ![...checks].some(c => c.checked);
                            "
                            >
                        </th>
                        <th>Pseudo</th>
                        <th>Nom</th>
                        <th>Pr√©nom</th>
                        <th>Email</th>
                        <th>Actif</th>
                        <th>Admin</th>
                    </tr>
                    </thead>
                </table>

                {# body scroll #}
                <div class="admin-table-scroll">
                    <table class="admin-table">
                        <tbody>
                        {# Parcours de la liste des utilisateurs fournie par le contr√¥leur #}
                        {% for u in users %}
                            <tr>
                                <td class="admin-check-col">
                                    {# Chaque checkbox envoie un tableau user_ids[] au POST #}
                                    <input
                                            type="checkbox"
                                            name="user_ids[]"
                                            value="{{ u.id }}"
                                            aria-label="S√©lectionner {{ u.pseudo }}"
                                            onchange="
                                        const checks = document.querySelectorAll('input[name=&quot;user_ids[]&quot;]');
                                        document.getElementById('btn_delete').disabled = ![...checks].some(c => c.checked);
                                        document.getElementById('check_all').checked = [...checks].every(c => c.checked);
                                    "
                                    >
                                </td>

                                {# Infos utilisateur #}
                                <td>{{ u.pseudo }}</td>
                                <td>{{ u.nom }}</td>
                                <td>{{ u.prenom }}</td>
                                <td>{{ u.mail }}</td>
                                <td>{{ u.actif ? 'Oui' : 'Non' }}</td>
                                <td>{{ u.administrateur ? 'Oui' : 'Non' }}</td>
                            </tr>

                        {% else %}
                            <tr>
                                <td colspan="7">Aucun utilisateur</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="admin-users-actions mt-3">
                <button
                        id="btn_delete"
                        class="btn btn-danger"
                        type="submit"
                        disabled
                        onclick="return confirm('Supprimer les utilisateurs s√©lectionn√©s ?')"
                >
                    Supprimer la s√©lection
                </button>
            </div>


        </form>

    </main>
{% endblock %}
