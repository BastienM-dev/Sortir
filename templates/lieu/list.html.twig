{% extends 'base.html.twig' %}

{% block title %}Gestion des lieux{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Gestion des lieux</h1>

    <a href="{{  path('lieu_create') }}" class="btn btn-primary">Créer un nouveau lieu</a>
        </div>

    <p class="text-muted">Liste des lieux ({{ lieux|length }})</p>

    {% if lieux is empty %}
        <div class="alert alert-info">Aucun lieu enregistré pour le moment.</div>
    {% else %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
            <tr>
                <th>Nom</th>
                <th>Rue</th>
                <th>Ville</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Nb sorties</th>
                <th class="text-center">Actions</th>
            </tr>
                </thead>
                    <tbody>
                    {% for lieu in lieux %}
                        <tr>
                            <td>{{ lieu.nom }}</td>
                            <td>{{ lieu.rue ?? '-' }}</td>
                            <td>{{ lieu.ville.nom }}</td>
                            <td>{{ lieu.latitude ?? '-' }}</td>
                            <td>{{ lieu.longitude ?? '-' }}</td>
                            <td>{{ lieu.sorties|length }}</td>
                            <td class="text-center">
                                {% if is_granted('ROLE_ADMIN') %}
                                    <a href="{{ path('lieu_edit', {id: lieu.id}) }}" class="btn btn-sm btn-warning">Modifier</a>
                                    <form method="post" action="{{ path('lieu_delete', {id: lieu.id}) }}" style="display:inline;" onsubmit="return confirm('Supprimer ce lieu ?');">
                                        <button type="submit" class="btn btn-sm btn-danger" {% if lieu.sorties|length > 0 %}disabled{% endif %}>Supprimer</button>
                                    </form>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
            </table>
        </div>
    {% endif %}

        <div class="mt-4">
            <a href="{{  path('sortie_list') }}" class="btn btn-secondary">Retour à l'accueil</a>
        </div>
    </div>
{% endblock %}